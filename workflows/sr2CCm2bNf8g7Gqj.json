{
  "active": false,
  "connections": {
    "Download file": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          },
          {
            "node": "Initialize Tracking",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Pinecone Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader": {
      "ai_document": [
        [
          {
            "node": "Pinecone Vector Store",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Recursive Character Text Splitter": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "Upload to Llama Cloud": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Check Parsing Status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Parsing Status": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Extract Markdown from Llama Cloud",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "Check Parsing Status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Markdown from Llama Cloud": {
      "main": [
        [
          {
            "node": "Clean Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "Pinecone Vector Store1",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader1": {
      "ai_document": [
        [
          {
            "node": "Pinecone Vector Store1",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Recursive Character Text Splitter1": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader1",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "Pinecone Vector Store1": {
      "main": [
        [
          {
            "node": "Track Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Track Success": {
      "main": [
        [
          {
            "node": "Final Success Counter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Final Success Counter": {
      "main": [
        [
          {
            "node": "Statistics Collector",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Clean Text": {
      "main": [
        [
          {
            "node": "Pinecone Vector Store1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders": {
      "main": [
        [
          {
            "node": "Download file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "Pinecone Vector Store",
            "type": "main",
            "index": 0
          },
          {
            "node": "Upload to Llama Cloud",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Statistics Collector": {
      "main": [
        [
          {
            "node": "Generate CSV Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate CSV Report": {
      "main": [
        [
          {
            "node": "Upload file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload file": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-09-03T13:13:23.923Z",
  "id": "sr2CCm2bNf8g7Gqj",
  "isArchived": true,
  "meta": null,
  "name": "My workflow 4",
  "nodes": [
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $json.id }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        464,
        416
      ],
      "id": "6ad21b76-59da-4316-bdb8-5d0e472bd278",
      "name": "Download file",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "nS2jCbjxOoaDloUK",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "mode": "insert",
        "pineconeIndex": {
          "__rl": true,
          "value": "brochure",
          "mode": "list",
          "cachedResultName": "brochure"
        },
        "options": {
          "pineconeNamespace": "brochure info"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
      "typeVersion": 1.3,
      "position": [
        2416,
        160
      ],
      "id": "2cf675c5-8856-41dc-b848-898be98ded06",
      "name": "Pinecone Vector Store",
      "credentials": {
        "pineconeApi": {
          "id": "bqNx5oAwXmTYQGz2",
          "name": "PineconeApi account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        2400,
        384
      ],
      "id": "28a11bdd-39f5-415f-bb59-efb16d243a16",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "ESQcfuiJYPWo7F8F",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "dataType": "binary",
        "textSplittingMode": "custom",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        2560,
        368
      ],
      "id": "b81b0b43-78e3-4ea9-993b-40d8428e1720",
      "name": "Default Data Loader"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        2560,
        528
      ],
      "id": "7b2bd6ff-b536-45bd-8119-35a3d429b396",
      "name": "Recursive Character Text Splitter"
    },
    {
      "parameters": {
        "content": "## INDEX BROCHURE",
        "height": 592,
        "width": 1808,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1008,
        96
      ],
      "typeVersion": 1,
      "id": "99378e29-fdb7-4afe-9124-dbf25a5e1cc7",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "amount": 30
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1264,
        1008
      ],
      "id": "c83c5f8b-2e5c-4cd2-b251-5e37f18b2ce0",
      "name": "Wait",
      "webhookId": "650aed56-944b-47c4-ab90-847d1a482edf"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.cloud.llamaindex.ai/api/v1/parsing/upload",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            },
            {
              "name": "Authorization",
              "value": "Bearer llx-7gl0VrHRB8dzykWVlgsnafemTct2O1L0aNt1JMEJy3crv7eS"
            }
          ]
        },
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "parameterType": "formBinaryData",
              "name": "file",
              "inputDataFieldName": "data"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1056,
        1008
      ],
      "id": "2e1773cc-22f0-4305-af1f-eb2c006f34e0",
      "name": "Upload to Llama Cloud"
    },
    {
      "parameters": {
        "url": "=https://api.cloud.llamaindex.ai/api/v1/parsing/job/{{ $('Upload to Llama Cloud').item.json.id }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            },
            {
              "name": "Authorization",
              "value": "Bearer llx-7gl0VrHRB8dzykWVlgsnafemTct2O1L0aNt1JMEJy3crv7eS"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1472,
        1008
      ],
      "id": "cbc32895-9523-45be-8206-0783dff12b62",
      "name": "Check Parsing Status"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "0954cab1-6f2c-4dc9-9a46-2c0ac8784614",
              "leftValue": "={{ $json.status }}",
              "rightValue": "SUCCESS",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1680,
        1008
      ],
      "id": "611053dc-f1f3-4ae2-93d5-9d3645233f9c",
      "name": "If"
    },
    {
      "parameters": {
        "amount": 60
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1952,
        1216
      ],
      "id": "95d482c9-5c92-4e10-ae62-546d2deab678",
      "name": "Wait1",
      "webhookId": "3ceb46c8-52a4-49a1-b3c7-f5196c768ff6"
    },
    {
      "parameters": {
        "url": "=https://api.cloud.llamaindex.ai/api/v1/parsing/job/{{ $json.id }}/result/markdown",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            },
            {
              "name": "Authorization",
              "value": "Bearer llx-7gl0VrHRB8dzykWVlgsnafemTct2O1L0aNt1JMEJy3crv7eS"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1952,
        912
      ],
      "id": "a606437c-d6a6-4493-a75b-0aee8f91f2bc",
      "name": "Extract Markdown from Llama Cloud"
    },
    {
      "parameters": {
        "mode": "insert",
        "pineconeIndex": {
          "__rl": true,
          "value": "brochure-llama",
          "mode": "list",
          "cachedResultName": "brochure-llama"
        },
        "options": {
          "pineconeNamespace": "brochure_info"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
      "typeVersion": 1.3,
      "position": [
        2432,
        912
      ],
      "id": "2504acba-fa6e-4c9f-9bce-4d02a8a90bf1",
      "name": "Pinecone Vector Store1",
      "credentials": {
        "pineconeApi": {
          "id": "bqNx5oAwXmTYQGz2",
          "name": "PineconeApi account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        2432,
        1120
      ],
      "id": "72db6458-abff-4932-9212-cc86f789eef5",
      "name": "Embeddings OpenAI1",
      "credentials": {
        "openAiApi": {
          "id": "ESQcfuiJYPWo7F8F",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "textSplittingMode": "custom",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        2576,
        1120
      ],
      "id": "1dd0c7b8-1d22-4354-9e93-7b8d2926c338",
      "name": "Default Data Loader1"
    },
    {
      "parameters": {
        "chunkOverlap": 200,
        "options": {
          "splitCode": "markdown"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        2672,
        1328
      ],
      "id": "8d21d286-9a05-4c24-bffb-26d872e12737",
      "name": "Recursive Character Text Splitter1"
    },
    {
      "parameters": {
        "content": "## LLAMA INDEX",
        "height": 736,
        "width": 1824
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1008,
        800
      ],
      "typeVersion": 1,
      "id": "e8372c82-afb1-4cc2-bf0b-77ac6ff4cdd9",
      "name": "Sticky Note1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1968,
        800
      ],
      "typeVersion": 1,
      "id": "f89f49b4-222e-41cb-b155-72272840bf91",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "## ðŸ“Š PROCESAMIENTO DE BROCHURES CON CONTEO\n\n### Flujo:\n1. **Google Drive Trigger** â†’ Detecta nuevos archivos\n2. **Download + Initialize Counter** â†’ Descarga e inicia tracking\n3. **Dual Processing:**\n   - **Ruta BÃ¡sica**: VectorizaciÃ³n directa con Pinecone\n   - **Ruta LlamaIndex**: Procesamiento avanzado con LlamaCloud\n4. **Success Tracking** â†’ Registro de cada Ã©xito\n5. **Statistics** â†’ ConsolidaciÃ³n de mÃ©tricas\n\n### MÃ©tricas Disponibles:\n- âœ… Archivos procesados exitosamente\n- â±ï¸ Tiempo promedio de procesamiento  \n- ðŸ“Š EstadÃ­sticas por tipo de vectorizaciÃ³n\n- ðŸ“ Cantidad de texto procesado\n- ðŸ“ˆ Eficiencia del sistema",
        "height": 800,
        "width": 976,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -16,
        -96
      ],
      "typeVersion": 1,
      "id": "a3234910-d350-4127-b37c-4ea7c39e6d39",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "jsCode": "// TRACKING Ã‰XITO PROCESAMIENTO LLAMA\nconst currentTime = new Date().toISOString();\nconst fileName = $json.file_name || 'desconocido';\nconst textLength = $json.text_length || 0;\n\nconsole.log(`âœ… LLAMA completado: ${fileName}, ${textLength} chars`);\n\nreturn {\n  json: {\n    ...items[0].json,\n    llama_processing_completed: currentTime,\n    llama_processing_status: 'exitoso',\n    processed_text_length: textLength,\n    step: 'vectorizacion_llama_completada'\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2912,
        912
      ],
      "id": "0892db47-0487-4605-a033-481aaf51b849",
      "name": "Track Success"
    },
    {
      "parameters": {
        "jsCode": "// CONTADOR FINAL DE ARCHIVOS PROCESADOS\nconst currentTime = new Date().toISOString();\nconst fileName = $json.file_name || 'desconocido';\n\n// Calcular tiempo total de procesamiento\nconst startTime = new Date($json.processing_start || currentTime);\nconst endTime = new Date(currentTime);\nconst processingTimeMs = endTime - startTime;\nconst processingTimeSeconds = Math.round(processingTimeMs / 1000);\n\n// Determinar quÃ© rutas se completaron\nconst basicCompleted = $json.basic_processing_status === 'exitoso';\nconst llamaCompleted = $json.llama_processing_status === 'exitoso';\n\n// Crear registro de Ã©xito completo\nconst successRecord = {\n  file_name: fileName,\n  file_id: $json.file_id,\n  processing_start: $json.processing_start,\n  processing_end: currentTime,\n  processing_time_seconds: processingTimeSeconds,\n  basic_vectorization: basicCompleted,\n  llama_vectorization: llamaCompleted,\n  both_completed: basicCompleted && llamaCompleted,\n  processed_text_length: $json.processed_text_length || 0,\n  status: 'completado_exitosamente'\n};\n\n// Log detallado para monitoreo\nconsole.log('ðŸŽ‰ ======= ARCHIVO PROCESADO EXITOSAMENTE =======');\nconsole.log(`ðŸ“„ Archivo: ${fileName}`);\nconsole.log(`â±ï¸  Tiempo: ${processingTimeSeconds}s`);\nconsole.log(`ðŸ“Š BÃ¡sico: ${basicCompleted ? 'âœ…' : 'âŒ'} | LlamaIndex: ${llamaCompleted ? 'âœ…' : 'âŒ'}`);\nif (llamaCompleted) {\n  console.log(`ðŸ“ Texto procesado: ${successRecord.processed_text_length} caracteres`);\n}\nconsole.log('===============================================');\n\nreturn { json: successRecord };"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3120,
        912
      ],
      "id": "0cc0fd39-c671-48c9-9104-e3de8b0acc56",
      "name": "Final Success Counter"
    },
    {
      "parameters": {
        "jsCode": "// Obtener el texto del nodo anterior (Markdown de LlamaIndex)\nconst input = $json.markdown || $json.text || \"\";\n\n// Copia de trabajo\nlet text = input;\n\n// --- Limpieza bÃ¡sica para espaÃ±ol ---\n\n// Quitar encabezados de documentos tipo \"PÃ¡gina 3\" o \"PÃ¡gina: 4\"\ntext = text.replace(/PÃ¡gina\\s*\\d+/gi, \"\");\n\n// Quitar lÃ­neas con solo nÃºmeros de pÃ¡gina\ntext = text.replace(/^\\s*\\d+\\s*$/gm, \"\");\n\n// Reemplazar separadores largos (---, ===, ___)\ntext = text.replace(/[-=_]{3,}/g, \"\\n\");\n\n// Normalizar entidades HTML comunes\ntext = text.replace(/&#x26;/g, \"&\");\ntext = text.replace(/&nbsp;/g, \" \");\n\n// Quitar caracteres extraÃ±os usados como viÃ±etas (â—, â– , â™¦, â–ª, âœ“, etc.)\ntext = text.replace(/[â—â– â™¦â–ªâœ“â€¢â€“â€”]/g, \"-\");\n\n// Quitar espacios dobles y tabulaciones\ntext = text.replace(/[ \\t]+/g, \" \");\n\n// Reducir saltos de lÃ­nea mÃºltiples a uno solo\ntext = text.replace(/\\n{2,}/g, \"\\n\\n\");\n\n// Eliminar espacios al inicio y fin\ntext = text.trim();\n\n// Devolver texto limpio para el siguiente nodo\nreturn { json: { normalizedText: text } };\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2224,
        912
      ],
      "id": "7b996160-5aeb-4309-b276-b6d14e6f8423",
      "name": "Clean Text"
    },
    {
      "parameters": {
        "jsCode": "// ESTADÃSTICAS CONSOLIDADAS\nconst allItems = items || [];\nconst currentDate = new Date().toISOString().split('T')[0];\nconst currentTime = new Date().toISOString();\n\nif (allItems.length === 0) {\n  console.log('âš ï¸ No hay elementos para procesar estadÃ­sticas');\n  return { json: { error: 'No items to process' } };\n}\n\n// Filtrar solo los registros exitosos\nconst successful = allItems.filter(item => \n  item.json.status === 'completado_exitosamente'\n);\n\nconst totalProcessed = successful.length;\n\n// Calcular estadÃ­sticas\nlet avgProcessingTime = 0;\nlet bothCompleted = 0;\nlet onlyBasic = 0;\nlet onlyLlama = 0;\nlet totalTextProcessed = 0;\n\nif (successful.length > 0) {\n  // Tiempo promedio\n  const totalTime = successful.reduce((sum, item) => {\n    return sum + (item.json.processing_time_seconds || 0);\n  }, 0);\n  avgProcessingTime = Math.round(totalTime / successful.length);\n  \n  // EstadÃ­sticas de vectorizaciÃ³n\n  successful.forEach(item => {\n    const basic = item.json.basic_vectorization;\n    const llama = item.json.llama_vectorization;\n    \n    if (basic && llama) {\n      bothCompleted++;\n    } else if (basic && !llama) {\n      onlyBasic++;\n    } else if (!basic && llama) {\n      onlyLlama++;\n    }\n    \n    totalTextProcessed += item.json.processed_text_length || 0;\n  });\n}\n\nconst statistics = {\n  date: currentDate,\n  timestamp: currentTime,\n  total_files_processed: totalProcessed,\n  successful_files: totalProcessed,\n  failed_files: 0, // En esta versiÃ³n solo contamos Ã©xitos\n  success_rate_percentage: 100, // 100% de los que llegan aquÃ­ son Ã©xitos\n  average_processing_time_seconds: avgProcessingTime,\n  total_text_characters_processed: totalTextProcessed,\n  vectorization_stats: {\n    both_methods_completed: bothCompleted,\n    only_basic_completed: onlyBasic,\n    only_llama_completed: onlyLlama\n  },\n  processing_efficiency: {\n    avg_chars_per_second: avgProcessingTime > 0 ? Math.round(totalTextProcessed / (totalProcessed * avgProcessingTime)) : 0,\n    files_per_minute: avgProcessingTime > 0 ? Math.round(60 / avgProcessingTime) : 0\n  },\n  last_updated: currentTime\n};\n\n// Log de estadÃ­sticas detalladas\nconsole.log('ðŸ“Š ======= ESTADÃSTICAS DE PROCESAMIENTO =======');\nconsole.log(`ðŸ“… Fecha: ${currentDate}`);\nconsole.log(`ðŸ“‹ Total procesados: ${totalProcessed}`);\nconsole.log(`â±ï¸  Tiempo promedio: ${avgProcessingTime}s`);\nconsole.log(`ðŸ“ Total caracteres: ${totalTextProcessed.toLocaleString()}`);\nconsole.log(`ðŸ”„ VectorizaciÃ³n completa (ambos): ${bothCompleted}`);\nconsole.log(`ðŸ“ˆ Eficiencia: ${statistics.processing_efficiency.files_per_minute} archivos/min`);\nconsole.log('=============================================');\n\nreturn { json: statistics };"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3344,
        912
      ],
      "id": "fca52722-0197-43a8-a048-a226d376cd04",
      "name": "Statistics Collector"
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "returnAll": true,
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "1TW1dAn5k6Qfv5j618EKlf3FStaklHN8V",
            "mode": "list",
            "cachedResultName": "brochure_mobilvendor",
            "cachedResultUrl": "https://drive.google.com/drive/folders/1TW1dAn5k6Qfv5j618EKlf3FStaklHN8V"
          }
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        288,
        416
      ],
      "id": "9f09ebe7-ef52-48ad-957b-cffe72779db2",
      "name": "Search files and folders",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "nS2jCbjxOoaDloUK",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        736,
        160
      ],
      "id": "7c5d0d3f-398a-4f10-9c8a-05c0af3bfcdc",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "jsCode": "// Consolidar todos los resultados en CSV\nconst allItems = items.map(i => i.json);\nconst headers = [\n  \"file_name\",\n  \"status\",\n  \"processing_time_seconds\",\n  \"processed_text_length\",\n  \"processing_start\",\n  \"processing_end\"\n];\n\nconst rows = allItems.map(item => [\n  item.file_name || \"\",\n  item.status || \"\",\n  item.processing_time_seconds || \"\",\n  item.processed_text_length || \"\",\n  item.processing_start || \"\",\n  item.processing_end || \"\"\n].join(\",\"));\n\nconst csvContent = [headers.join(\",\"), ...rows].join(\"\\n\");\n\nreturn [{\n  json: { fileName: `index.csv` },\n  binary: {\n    data: {\n      data: Buffer.from(csvContent, \"utf-8\"),\n      mimeType: \"text/csv\"\n    }\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3552,
        912
      ],
      "id": "a5e36f41-36a1-4c6b-b9df-1e6c29554c69",
      "name": "Generate CSV Report"
    },
    {
      "parameters": {
        "name": "index.csv",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1Dbtvi1Q_bP9iexd3B9OfK-U3shQTRthz",
          "mode": "list",
          "cachedResultName": "REPORTES",
          "cachedResultUrl": "https://drive.google.com/drive/folders/1Dbtvi1Q_bP9iexd3B9OfK-U3shQTRthz"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        3744,
        1424
      ],
      "id": "7aec6224-8164-4a8d-89b9-337e97210f4c",
      "name": "Upload file",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "nS2jCbjxOoaDloUK",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// INICIALIZAR TRACKING COMPLETO\nconst currentTime = new Date().toISOString();\nconst sessionId = `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\nconst fileName = $json.name || 'desconocido';\nconst fileId = $json.id || 'unknown';\n\nconsole.log(`ðŸš€ INICIANDO procesamiento: ${fileName}`);\nconsole.log(`ðŸ“‹ Session ID: ${sessionId}`);\n\n// Inicializar objeto de tracking completo\nconst trackingData = {\n  // IdentificaciÃ³n\n  session_id: sessionId,\n  file_name: fileName,\n  file_id: fileId,\n  \n  // Timestamps\n  processing_start: currentTime,\n  processing_end: null,\n  \n  // Estados de procesamiento\n  basic_processing_status: 'pendiente',\n  basic_processing_completed: null,\n  llama_processing_status: 'pendiente',\n  llama_processing_completed: null,\n  \n  // MÃ©tricas\n  processed_text_length: 0,\n  processing_time_seconds: 0,\n  \n  // Estado general\n  both_completed: false,\n  status: 'en_proceso',\n  step: 'iniciado'\n};\n\nreturn {\n  json: {\n    ...trackingData,\n    // Mantener datos originales del archivo\n    originalFileData: $json\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        736,
        0
      ],
      "id": "e29eed06-b676-4c1a-a660-1f58885c324a",
      "name": "Initialize Tracking"
    }
  ],
  "pinData": {
    "Wait": [
      {
        "json": {
          "id": "563b66aa-11c8-472a-8d3a-123380173a32",
          "created_at": "2025-09-01T17:31:02.660354Z",
          "updated_at": "2025-09-02T14:19:50.771658Z",
          "name": "Brochure-General-Distribuidor-Mobilvendor.pdf",
          "external_file_id": "Brochure-General-Distribuidor-Mobilvendor.pdf",
          "file_size": 10340726,
          "file_type": "pdf",
          "project_id": "586d0cdf-1d02-43e7-b8aa-3683da38040c",
          "last_modified_at": "2025-09-02T14:19:50Z",
          "resource_info": {
            "file_size": 10340726,
            "last_modified_at": "2025-09-02T14:19:50"
          },
          "permission_info": null,
          "data_source_id": null
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "createdAt": "2025-09-03T13:13:23.938Z",
      "updatedAt": "2025-09-03T13:13:23.938Z",
      "role": "workflow:owner",
      "workflowId": "sr2CCm2bNf8g7Gqj",
      "projectId": "IcIKCrtLDXlTBTP5"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-09-03T19:49:29.000Z",
  "versionId": "4bc8d5d5-63e6-4bee-8ced-5d73b257f3e1"
}